

<header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
    <div class="container" id="navbarContainer">
        <div class="navbar-header" id="navbarHeader">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../" class="navbar-brand"><%= __("Chaton")%></a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"> <%= __("home")%> <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#">Action</a></li>
                        <li class="divider"></li>
                        <li><a href="#"><%= __("My profile")%></a></li>
                        <li class="divider"></li>
                        <li><a href="#"><%= __("Log out")%></a></li>
                    </ul>
                </li>
            </ul>
            <p class="navbar-text navbar-right"><a href="#" class="navbar-link" id="usernameDisplay">????</a></p>
        </nav>
    </div>
    <div class="container banner" id="banner" >
        <svg class="banner" id="svgBanner">
        </svg>

    </div>
</header>
<section class="container" id="mainContent" >

</section>

<script type="text/javascript">

    var svgBanner = Snap("#svgBanner");
    var pageModel = {
        userData: {
            username: m.prop("???"),
            authenticated: m.prop(false),
            code: m.prop(9999)
        }
    };
    var mainContentInitController = function () {
        $.getJSON("/authentication/check")
                .done(function (data) {
                    pageModel.userData.username = data.username;
                    pageModel.userData.authenticated = data.authenticated;
                    pageModel.userData.code = data.code;
                    if (pageModel.userData.authenticated)
                    {
                        $("#usernameDisplay").text(pageModel.userData.username);
                        m.route("home");
                    } else
                    {
                        $("#usernameDisplay").text(pageModel.userData.username);
                        m.route("login");
                    }

                })
                .fail(function (jqxhr, textStatus, error) {
                    m.route("init");
                });
    };
    var mainContentInitView = function () {
        $("#usernameDisplay").text(pageModel.userData.username);
        return m("div", {role: "alert", class: "alert alert-warning"}, "<%= __('Initiating....')%>");
    };
    var loginPanelView = function (controller) {

        return m("div", {class: "panel panel-default"}, [
            m("div", {class: "panel-heading"}, [
                m("h1", {class: "panel-title"}, "<%= __('Login panel')%>")
            ]),
            m("div", {class: "panel-body"}, [
                m("form.form-horizontal", [
                    m(".form-group", [
                        m("label.col-sm-2.control-label[for='username']", "Username"),
                        m(".col-sm-10", [
                            m("input.form-control[id='username'][placeholder='Username'][type='text']")
                        ])
                    ]),
                    m(".form-group", [
                        m("label.col-sm-2.control-label[for='password']", "Password"),
                        m(".col-sm-10", [
                            m("input.form-control[id='password'][placeholder='Password'][type='password']")
                        ])
                    ]),
                    m(".form-group", [
                        m(".col-sm-offset-2.col-sm-10", [
                            m("button.btn.btn-default[type='submit']", {onclick: function () {
                                    $.post("/authentication/login", {
                                        username: $("#username").val(),
                                        password: $("#password").val()})
                                            .done(function (data) {
                                                pageModel.userData.username = data.username;
                                                pageModel.userData.authenticated = data.authenticated;
                                                pageModel.userData.code = data.code;
                                                if (data.authenticated)
                                                {
                                                    m.route("home");
                                                    $("#usernameDisplay").text(pageModel.userData.username);
                                                }
                                            })
                                            .fail(function (jqxhr, textStatus, error) {

                                            });


                                }}, "Sign in")
                        ])
                    ]),
                    "\n"
                ])
            ])
        ]);
    };
    var loginController = function (){ 

    };
    
    var homeController = function () {

    };
    
    var mainContentHomeView = function () {
        $("#usernameDisplay").text(pageModel.userData.username);
        return m("h3","TODO6") ;
    };
    
    var pageInit = function ()
    {
        m.route.mode = "hash";
        m.route(document.getElementById("mainContent"), "init", {
            "init": {controller: mainContentInitController, view: mainContentInitView},
            "login": {controller: loginController, view: loginPanelView},
            "home": {controller: homeController, view: mainContentHomeView}
        });
        $("#banner").animate({height: "60px", opacity: 0.5}, 4000);
    };
    $(document).ready(pageInit);


</script>
